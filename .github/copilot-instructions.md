# Инструкции для AI-агентов разработки cascade-vpn-universal

## Обзор проекта
**cascade-vpn-universal** — универсальный установщик каскадного VPN с возможностью маскировки трафика. Проект предоставляет модульные компоненты для настройки защищенных сетей VPN с использованием нескольких бэкендов.

## Архитектура

### Основная структура
- **`services/`** - Реализации VPN-бэкендов:
  - `v2ray/` - Интеграция V2Ray прокси-сервера
  - `xray/` - Интеграция Xray прокси-сервера  
  - `wireguard/` - Протокол VPN WireGuard
  - `3x-ui/` - Веб-интерфейс управления 3X-UI
  
- **`modules/`** - Функциональные модули:
  - `certificates/` - Управление SSL/TLS сертификатами
  - `clients/` - Конфигурация и развертывание клиентов
  - `obfuscation/` - Техники маскировки трафика
  - `port-forwarding/` - Правила переброски портов
  
- **`configs/`** - Шаблоны системных конфигураций:
  - `nginx/` - Конфигурации Nginx обратного прокси
  - `systemd/` - Файлы сервисов systemd
  - `sysctl/` - Настройка параметров ядра

### Процесс установки
- **`install.sh`** - Главный оркестратор установки (bash)
- **`update.sh`** - Логика обновления и апгрейда
- **`uninstall.sh`** - Чистое удаление компонентов
- **`etc/`** - Дополнительные конфигурации и скрипты

## Ключевые паттерны и соглашения

### Bash/Shell-скрипты
- Все скрипты установки используют bash (shebang: `#!/bin/bash`)
- Shell-скрипты обрабатывают системные операции (установка сервисов, развертывание конфигов)
- Конфиденциальные данные (ключи, сертификаты) исключены через `.gitignore`

### Управление конфигурацией
- Конфигурации на основе шаблонов в `configs/` для nginx, systemd и sysctl
- Модульные конфигурации сервисов позволяют комбинировать несколько бэкендов в одном развертывании
- Сетевая безопасность: сертификаты в `modules/certificates/`, правила портов в `modules/port-forwarding/`

### Интеграция сервисов
- Сервисы независимы, но составляемы (можно запускать v2ray + wireguard одновременно)
- Веб-интерфейс через 3x-ui для управления
- Слой маскировки трафика применяется ко всем сконфигурированным сервисам

### Соображения безопасности
- Приватные ключи, сертификаты и токены никогда не коммитятся (покрыто `.gitignore`)
- Учетные данные управляются через переменные окружения или защищенные файлы
- TLS/SSL обрабатывается модулем `modules/certificates/`

## Задачи разработки

### Добавление нового VPN-бэкенда
1. Создать папку в `services/<backend-name>/`
2. Реализовать логику запуска и конфигурации сервиса
3. Добавить соответствующий файл сервиса systemd в `configs/systemd/`
4. Зарегистрировать в оркестраторе установки (`install.sh`)
5. Протестировать с существующими модулями маскировки

### Добавление новой техники маскировки
1. Создать реализацию в `modules/obfuscation/<technique>/`
2. Определить интерфейс конфигурации совместимый с существующими сервисами
3. Добавить генерацию конфигурации клиента в `modules/clients/`
4. Обновить установщик для конфигурации маскировки при развертывании сервиса

### Изменение процесса установки
- Редактировать `install.sh` для оркестрации загрузки модулей
- Следовать существующим паттернам: sourcе файлы модулей, проверка предусловий, применение конфигов
- Всегда включать логику отката в соответствующие процедуры удаления

## Зависимости и интеграция
- **Системный уровень**: systemd, nginx, sysctl (для настройки ядра)
- **VPN-сервисы**: V2Ray, Xray, WireGuard
- **Интерфейс управления**: 3X-UI
- **Сборка/развертывание**: Bash, стандартные утилиты Linux

## Тестирование и валидация
- Пустая папка `tests/` указывает на необходимость тестового набора
- Рекомендуемые паттерны:
  - Тесты валидации скриптов (shellcheck)
  - Проверка запуска сервисов
  - Проверка корректности конфигураций
  - Тесты кросс-сервисной интеграции

## Пример структуры файлов
```
install.sh              # Главная точка входа
├─ source modules/certificates/init.sh
├─ source services/v2ray/install.sh
├─ source modules/obfuscation/shadowsocks/config.sh
└─ apply-configs configs/nginx/
```

## Расположение документации
- **LICENSE**: MIT (см. файл LICENSE)
- **Workflows**: GitHub Actions в `.github/workflows/`
- **Примеры**: Папка `examples/` (пустая - добавить примеры конфигураций)
- **Документы**: Папка `docs/` (пустая - добавить архитектурную документацию)

---

**Последнее обновление**: Декабрь 2025
**Статус**: Проект в активной разработке (этап скаффолдинга)
